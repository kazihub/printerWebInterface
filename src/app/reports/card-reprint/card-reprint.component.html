<div class="page-header">
  <h1>Card Reprint Report</h1>
</div>
<nz-card>
  <div class="d-flex justify-content-between">
    <div nz-form [nzLayout]="'inline'">
      <nz-form-item>
       <nz-form-control>
        <nz-select [(ngModel)]="exportValue" (ngModelChange)='exportData(exporter, $event)' style="width: 200px;" nzAllowClear nzPlaceHolder="Export as">
          <nz-option nzValue="Excel" nzLabel="Excel"></nz-option>
          <nz-option nzValue="txt" nzLabel="Text"></nz-option>
          <nz-option nzValue="csv" nzLabel="Csv"></nz-option>
        </nz-select>
       </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-range-picker [(ngModel)]="dateRange"></nz-range-picker>
      </nz-form-item>
      <nz-form-item>
        <button nz-button nzType="primary" (click)="findData()" >Search</button>
      </nz-form-item>
    </div>
    <div nz-form [nzLayout]="'inline'">
      <mat-form-field>
        <input matInput (keyup)="applyFilter($event.target.value)" placeholder="Filter">
      </mat-form-field>
      <mat-paginator [pageSizeOptions]="[5, 10, 25, 100, rePrints.length]"></mat-paginator>
    </div>
  </div>
  <table matTableExporter #exporter="matTableExporter" [hiddenColumns]="[0, 7]" mat-table matSort multiTemplateDataRows class="bordered" [dataSource]="dataSource" width="100%">
    <ng-container matColumnDef="subtable">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let elemant">
        <i style="font-size: 20px" *ngIf="!elemant.show" (click)="toggleRow(elemant)" nz-icon [nzType]="'plus-circle'" [nzTheme]="'twotone'"></i>
        <i style="font-size: 20px" *ngIf="elemant.show" (click)="toggleRow(elemant)" nz-icon [nzType]="'minus-circle'" [nzTheme]="'twotone'" [nzTwotoneColor]="'#eb0e0a'"></i>
      </td>
    </ng-container>
    <ng-container matColumnDef="receiptNumber">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Receipt Number</th>
      <td mat-cell *matCellDef="let ele">{{ele.cardPrint?.receiptNumber}}</td>
    </ng-container>
    <ng-container matColumnDef="User">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>User</th>
      <td mat-cell *matCellDef="let ele">{{ele.user}}</td>
    </ng-container>
    <ng-container matColumnDef="needApproval">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Needs Approval</th>
      <td mat-cell *matCellDef="let ele">{{ele.needsApproval}}</td>
    </ng-container>
    <ng-container matColumnDef="approver">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Approver</th>
      <td mat-cell *matCellDef="let ele">{{ele.approver}}</td>
    </ng-container>
    <ng-container matColumnDef="Approved">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Approved</th>
      <td mat-cell *matCellDef="let ele">
        {{ele.approved}}
      </td>
    </ng-container>
    <ng-container matColumnDef="ApprovedDate">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Approved Date</th>
      <td mat-cell *matCellDef="let ele">{{ele.approvedDate | amDateFormat: 'LL hh:mm A'}}</td>
    </ng-container>
    <ng-container matColumnDef="expandedDetail">
      <td mat-cell *matCellDef="let item" [attr.colspan]="displayedColumns.length">
        <table class="child-table-div" mat-table [dataSource]="item.data"  style="width: 100%" matSort class="bordered">
          <ng-container matColumnDef="field">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Field</th>
            <td mat-cell *matCellDef="let elemant">{{elemant.queryFields.columnName}}</td>
          </ng-container>
          <ng-container matColumnDef="value">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Value</th>
            <td mat-cell *matCellDef="let elemant">
              {{formateDate(elemant.queryFieldValue)}}
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="mainColumns;"></tr>
          <tr mat-row *matRowDef="let row; columns: mainColumns;"></tr>
        </table>
      </td>
    </ng-container>
    <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns" class="element-row"></tr>
    <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" style="overflow: hidden"
        align="center" [hidden]="!row.show"></tr>
  </table>
</nz-card>
